<%= render 'bars/top2' %>
<div class="wrapper has-sidebar-left">
  <%= render 'sidebars/loginside' %>
    <div class="container main-content">
    <p id="notice"><%= notice %></p>

    <h1>Users</h1>
    <% if logged_in? %>
    <p>
      Logged in as <%= current_user.Name %> <%= link_to 'Log out?', logout_url, method: "delete" %>
    </p>

    <% else %>
    <p>
      <%= link_to 'Log in', login_url %>
    </p>

    <% end %>
    <div class="table">
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Username</th>
            <th>Created Date</th>
            <th>Updated Date</th>
            <th colspan="3"></th>
          </tr>
        </thead>

        <tbody>
          <% 
          @users.each do |user| %>
            <tr>
              <td><%= user.Name %></td>
              <td><%= user.username %></td>
              <td><%= user.created_at.strftime("%l:%M %p %B %m, %Y") %></td>
              <td><%= user.updated_at.strftime("%l:%M %p %B %m, %Y") %></td>
              <td><%= link_to 'More', user, class: 'btn-primary btn' %></td>
              <td>
              
              <% if logged_in? #TODO Extend has_role for nil to return false 
                %>
                <% if ( (user.id == current_user.id) || (current_user.can? "edit", "user") ) %>
                <%= link_to 'Edit', edit_user_path(user), class: 'btn btn-primary' %>
                <% end %>
              <% end %>
              </td>
              <td>

              <% if logged_in? %>
                <% if (current_user.can? :delete, :User) %>
                  <%= link_to 'Delete', user, method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-primary' %>
                <% end %> 
              <% end; %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

  </div>
</div>
