<style>
.btn-group {
  border: .05em solid silver;
  border-radius: .3em;
  height: 3.8em;
  margin: .1em .1em;
  padding: .05em;
}
.panel-default {
  padding: .1em;
}
.btn-group-2 {
  margin: .05em;
  height: 50%;
}
.nocheck {
  display: none;
}
.btn-option {
  padding: .3em;
}
.btn-parent {
  width: 100%;
  font-size: 1em;
}
.btn-child {
  width: 47%;
  height: 100%;
  padding: .2em;
  font-size: .7em;
}
</style>

<div class="option">
  
  <% @options.each do |a| %>
  
    <% @relatedoptions = [] %>
    <% @relatedoptions.push((lead + a.id.to_s).to_s) %>
    
    
      <% if a.ChildOf.nil? %> <%# normal button %>
      
        <% if Palconfig.where('name = ?', 'optiondisplay').first.val1 == 'long' %> <%# need to control the width on btn-group if we're using short optiondisplay %>
          <div class="btn-group" style="min-width: 4em;" data-toggle="buttons">
        <% else %>
          <div class="btn-group" style="width: 4em;" data-toggle="buttons">
        <% end %>
          <div class=".btn-group-2">
            
            <% if !currentops.nil? %>
              <% if currentops.include?(a.id.to_s) %>
                <label class="btn btn-option btn-parent active">
                  <%= check_box_tag ops, a.id, true, id: ((lead + a.id.to_s).to_s), class: 'nocheck' %>
                  <% if Palconfig.where('name = ?', 'optiondisplay').first.val1 == 'long' %>
                    <%= a.Name %>
                  <% else %>
                    <%= a.Abbreviation %>
                  <% end %>
                </label>
                <% else %>
                <label class="btn btn-option btn-parent">
                  <%= check_box_tag ops, a.id, false, id: ((lead + a.id.to_s).to_s), class: 'nocheck' %>
                  <% if Palconfig.where('name = ?', 'optiondisplay').first.val1 == 'long' %>
                    <%= a.Name %>
                  <% else %>
                    <%= a.Abbreviation %>
                  <% end %>
                </label>
              <% end %>
            <% else %>
              <% if (@product.freeoptions).include?(a.id.to_s) %>
                <label class="btn btn-option btn-parent active">
                  <%= check_box_tag ops, a.id, true, id: ((lead + a.id.to_s).to_s), class: 'nocheck' %>
                  <% if Palconfig.where('name = ?', 'optiondisplay').first.val1 == 'long' %>
                    <%= a.Name %>
                  <% else %>
                    <%= a.Abbreviation %>
                  <% end %>
                </label>
              <% else %>
                <label class="btn btn-option btn-parent">
                  <%= check_box_tag ops, a.id, false, id: ((lead + a.id.to_s).to_s), class: 'nocheck' %>
                  <% if Palconfig.where('name = ?', 'optiondisplay').first.val1 == 'long' %>
                    <%= a.Name %>
                  <% else %>
                    <%= a.Abbreviation %>
                  <% end %>
                </label>
              <% end %>
            <% end %>
          </div>
          
          <div class=".btn-group-2">
            <% @options.each do |b| %>
              <% if b.ChildOf == a.id %>
                <% @relatedoptions.push(lead + b.id.to_s) %>
                <% if !currentops.nil? %>
                  <% if currentops.include?(b.id.to_s) %>
                    <label class="btn btn-option btn-child active">
                    <%= check_box_tag ops, b.id, true, id: ((lead + b.id.to_s).to_s), class: 'nocheck' %>
                    <% if b.Name.include?('Extra') %>
                        <%= 'X' %>
                      <% elsif b.Name.include?('Light') %>
                        <%= 'LT' %>
                      <% else %>
                        <%= b.Abbreviation%>
                      <% end %>
                    </label>
                  <% else %>
                    <label class="btn btn-option btn-child">
                      <%= check_box_tag ops, b.id, false, id: ((lead + b.id.to_s).to_s), class: 'nocheck' %>
                      <% if b.Name.include?('Extra') %>
                        <%= 'X' %>
                      <% elsif b.Name.include?('Light') %>
                        <%= 'LT' %>
                      <% else %>
                        <%= b.Abbreviation%>
                      <% end %>
                    </label>
                  <% end %>
                <% else %>
                  <% if (@product.freeoptions).include?(b.id.to_s) %>
                    <label class="btn btn-option btn-child active">
                      <%= check_box_tag ops, b.id, true, id: ((lead + b.id.to_s).to_s), class: 'nocheck' %>
                      <% if b.Name.include?('Extra') %>
                        <%= 'X' %>
                      <% elsif b.Name.include?('Light') %>
                        <%= 'LT' %>
                      <% else %>
                        <%= b.Abbreviation%>
                      <% end %>
                    </label>
                  <% else %>
                    <label class="btn btn-option btn-child">
                      <%= check_box_tag ops, b.id, false, id: ((lead + b.id.to_s).to_s), class: 'nocheck' %>
                      <% if b.Name.include?('Extra') %>
                        <%= 'X' %>
                      <% elsif b.Name.include?('Light') %>
                        <%= 'LT' %>
                      <% else %>
                        <%= b.Abbreviation%>
                      <% end %>
                    </label>
                  <% end %>
                <% end %>
              <% end %>
            <% end %>
          </div>
          
          <% if @relatedoptions.length > 1 %>
  
            <script>
              <%= "$(document).ready(function() {" %>
              <% @relatedoptions.each do |this| %>
                <%= "$('#".html_safe + this.to_s + "').closest(\"label\").click(function(){".html_safe %>
                <%= "console.log('message');".html_safe %>
                <% @relatedoptions.each do |that| %>
                  <% if that != this %>
                    <%= "$('#".html_safe + that.to_s + "').prop(\"checked\", false);".html_safe %>
                    <%= "$('#".html_safe + that.to_s + "').closest(\"label\").removeClass(\"active\");".html_safe %>
                  <% end %>
                <% end %>
                <%= "});" %>
              <% end %>
            <%= "});" %>
            </script>
          
          <% end %>
        </div>
      <% end %>
    
  <% end %>
</div>